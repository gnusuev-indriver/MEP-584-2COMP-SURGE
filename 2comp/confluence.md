Статья: "Двукомпонентный сурж и Определение мисспрайсинга длинных суржащих поездок"
В период высокого спроса в сервисе включается сурж – механизм, повышающий рекомендованную цену, рассчитанную по тарифу, в соответствии с изменением баланса спроса и предложения. Так как настройки механизма могут быть разные, то может возникнуть мисспрайсинг. Как его определять?
 Беглый взгляд на мисспрайсинг
Этот гайд пишется в контексте работы с двукомпонентным суржом как способом устранения оверпрайсинга длинных поездок, поэтому
Заходим в дэш о двукомпонентном сурже (ниже опишу еще, что это такое) и выставляем там все нужные настройки.
Вот сслыка: https://redash-analytics.dwh.console3.com/public/dashboards/s8CcPyQZERAqEfoTBHInYJWcyvzZyPr0zDNJnR1P?org_slug=default
Главный график – OrderPrice2HighratePrice vs Distance
OrderPrice2HighratePrice = OrderPrice/HighratePrice - 1
                         ,
 где OrderPrice – цена выполненного заказа (Done Price)
где HighratePrice – рекомендованная цена (Rec Price)
На этом графике смотрим на метрику OrderPrice2HighratePrice, построенную по поездкам без суржа (=1) и по поездкам с суржом (>1).
Целевая картина
Предполагаю, что целевая картина для первых – это ровная горизонтальная прямая выше нуля. Это означает, что для любой поездки рекомендованная цена является рыночной и отличается от цены поездки Done Price только из-за особенностей дизайна аукциона (можно, наверное, обобщенно назвать это “жадностью водителей“).
В таком случае для второй кривой целевая картина такая же и значение метрики совпадает со значением на несуржовых поездках. Это означало бы, что в час пик (сурж) рекомендованная цена снова справедливая и отличие от нее цены Done Price обуславливается все теми же причинами, а не рыночными условиями (соотношением спроса и предложения).
Оверпрайс в сурж
Такое отклонение от целевой картины, где в сурж OrderPrice2HighratePrice на длинных поездках загибается вниз, можно считать следствием завышенной цены. В этой ситуации может помочь формула двукомпонентного суржа.
В случае других отклонений от целевой картины (например, OrderPrice2HighratePrice на поездках с суржом ниже на всех поездках) можно предположить, что суржовые поездки слишком дорогие, но двукомпонентным суржом это не лечится.
 Двукомпонентный сурж
Принцип действия
Рассчитывается новый параметр surcharge – надбавка (аддитивная) к цене.
Формула: surcharge = axis_price * (surge - 1)
При таком определении поездка, которая не в сурж стоила axis_price, в сурж при использовании двукомпонентной формулы будет стоить столько же, сколько стоила бы в сурж без применения этой формулы.
Выставляются параметры α и β, где
α+β=1
α – вес мультипликативной части
β – вес аддитивной части.
Получается новая рекомендованная цена в сурж:
Highrate = base_price * (α*surge + β) + β*surcharge
Результат
В сурж цена поездки, base_price которой выше, чем axis_price, становится ниже, чем при алгоритме ценообразования без применения двукомпонентной формулы (и наоборот для поездки дешевле)

Увеличение веса аддитивной части β разворачивает прямую цены сильнее.
А цена axis_price определяет “ось вращения“.

Пример можно видеть на рисунке ниже и в игрушечном калькуляторе по ссылке.
[Guide] Двукомпонентный сурж и Определение мисспрайсинга длинных суржащих поездок


Статья "[2024-09] Определение длинных поездок|"
Длинные поездки – поездки, доля которых увеличивается в выходные дни.
 Пересечение распределений поездок в будни и выходные происходит на уровне ~8.7-9.3 км. Доля таких поездок варьируется от 35% в будни до 40% в выходные.
Сезонность
У распределений поездок по длине  в Лиме за период с 1 марта 2024 по 1 июня 2024 есть выраженная сезонность. Для каждой даты я построил распределения поездок по длине (в километрах) и для всех пар дней рассчитал расстояние Кульбака — Лейблера.
Характер распределений можно оценить на представленной ниже диаграмме.


Хитмэп расстояний Кульбака — Лейблера показан ниже. Более яркие точки соответствуют парам дней с большими различиями в распределениях. Сезонность этих различий очевидна. При более детальном рассмотрении оказывается, что эти различия связаны с будними и выходными днями (а иногда — с праздничными днями).
Агрегация поездок по дням недели.
Из хитмапа видно не только наличие сезонности, но и схожесть распределений для будних и выходных дней между собой соответственно.
Кроме того, обнаружено утолщение правого хвоста распределения поездок в выходные дни.
Определение длинных.
На основе этих наблюдений я определил длинные поездки как те, доля которых увеличивается в выходные дни.
 Я агрегировал поездки по типу дня (day_type ∈ {weekday, weekend}). Пересечение распределений поездок в будни и выходные происходит на уровне ~8.7-9.3 км. Доля таких поездок варьируется от 35% в будни до 40% в выходные.


Статья: "[2024-10] Поиск мисспрайсинга длинных поездок"

из [2024-09]: Длинными поездками определены поездки с дистанцией от ~8.7-9.3 км.
Предлагаемое решение – Двукомпонентный сурж
Оценка эффекта:
Вся сеть (с учетом текущей доли суржовых поездок)
Пессимистичная оценка:: +0.58% DR*check
В оценке не учитывается ожидаемое увеличение DonePrice (check), связанное с реализацией повышенной переговорной силы водителей в контексте изменившегося предложения.
Также не учитывается изменение ShowPrice2Order, вызванное уменьшением HighRate Price на длинных поездках и увеличением на коротких.
Результат: в сурж цена поездки, base_price которой выше, чем base_price_AVG, становится ниже, чем при алгоритме однокомпонентного суржа (и наоборот для поездки дешевле)
mixed_surge x2 – график цены в сурж с коэффициентом 2 при алгоритме двукомпонентного суржа
Принцип действия:
Получаю новый параметр surcharge
surcharge = base_price_AVG * (surge - 1)
При таком определении поездка по цене base_price_AVG в сурж будет стоить столько же, сколько стоила бы при алгоритме однокомпонентного суржа.
Выставляю параметры α и β, где
α+β=1
α – вес мультипликативной части
β – вес аддитивной части.
Получаю новую, суржащую, рекомендованную цену
Highrate = base_price * (α*surge + β) + β*surcharge


Мисспрайсинг: На длинных поездках с суржом orderprice приближается к highrate. В какой-то момент это может быть свидетельством среза спроса в результате пересурживания.
Утилизация водителей: Водители, берущие длинные поездки, имеют значительно более высокую утилизацию (60%) по сравнению с теми, кто избегает длинных поездок (40%). Однако лишь 2% водителей не берут длинные поездки.
Корреляция с суржем: Отношение orderprice к highrate коррелирует с величиной суржа по поездкам.
Анализ по метрикам: В кривых MPH на очень длинных поездках иногда наблюдается рост. Также интересны точки перелома в трендах DR, которые возникают на отметках 8-10 км и 15-16 км.
Временной промежуток
Для этого этапа анализа я выбрал промежуток времени с 26 июня по 29 июля. Цель заключалась в том, чтобы выбрать период, где влияние суржа было максимально актуальным, настройки эксперимента не слишком ограничивали объем данных, а доля поездок с суржом и коэффициент суржа оставались стабильными.
С 1 марта 2024 по 1 июня 2024 использовались различные модели и настройки суржа. На графике ниже показана доля каждого метода расчета суржа (calculator_id) среди всех расчетов цены. На следующем графике изображены доля поездок с суржом и средний коэффициент суржа за этот период.

На момент написания самый актуальный сурж с calculator_id = 11408, который активен с 30 июля. В это время наблюдается значительное снижение как доли поездок с суржом, так и среднего коэффициента суржа по сравнению с предыдущим периодом с 26 июня по 29 июля, когда использовался сурж с calculator_id = 10079 (и, возможно, в свитчбэке — сурж с calculator_id = 10761).
С 26 июня по 29 июля доля поездок с суржом в будни выросла с 47% до 66%, а в выходные дни  — с 79% до 92%. Коэффициент суржа в этот период не выглядел аномальным по сравнению с другими периодами.
Утилизация водителей
Я также проанализировал утилизацию водителей, которые берут и не берут длинные поездки. В этих двух группах утилизация значительно различается: 60% для водителей, которые берут длинные поездки, и 40% для тех, кто не берёт. Однако лишь 2% водителей не берут длинные поездки.


Поездки без суржа
Разница между highrate и orderprice (рис. 3) практически постоянна для поездок разной длины как в будни, так и в выходные, для поездок без суржа.
Однако для поездок без суржа на выходных водители отторговывают больше, чем в будни. Это можно объяснить рыночными условиями, где баланс спроса и предложения смещен в сторону спроса:
Коэффициент суржа по поездкам (рис. 4) выше в выходные дни.
Количество бидов на заказ (рис. 5) ниже в выходные дни, что снижает конкуренцию между водителями за поездку.
Количество бидов на поездку растет, но заработок водителей в час (MPH) остается стабильным, что говорит о том, что увеличение предложения не приводит к снижению цены (точнее — цены труда водителей). Это можно объяснить наличием плато в MPH, которое соответствует минимальной оплате, на которую водители соглашаются в текущих рыночных условиях. На выходных этот минимум выше из-за наличия большого количества поездок с суржом, что создает для водителей сильную альтернативную опцию. В результате, DR снижается.
Что касается кривых MPH, плато не всегда является стабильным: иногда на очень длинных поездках можно наблюдать рост, что может быть предметом дальнейшего исследования.
Интересно, что тренд DR преломляется дважды: около поездок длиной 8-10 км и снова около 15-16 км. Эти значения являются характерными не только для DR, но и для других метрик, и это также может стать предметом дальнейшего исследования.
Поездки с суржом
Для поездок с суржом, начиная с определенной длины поездки (там, где начинаются длинные поездки – около 8-10 км), orderprice начинает приближаться к highrate. Хотя количество бидов на поездку увеличивается, оно остается ниже для всех длин поездок по сравнению с поездками без суржа. В часы пик (отождествляю с ростом суржа по поездкам) спрос увеличивается до поездок длиной 8-10 км, где мы видим рост спроса и ослабление давления со стороны предложения. В результате, в будни на поездках до 15 км водители отторговывают себе большую долю от highrate в часы пик, чем в часы не пик (для поездок без суржа).
 В будни снижение спроса (падение суржа по поездкам) и увеличение конкуренции (рост числа бидов на заказ) приводят к тому, что водители могут отторговать меньшую долю от highrate, чем в часы не пик. Это может свидетельствовать о пересурживании, которое привело к избыточному снижению спроса. Избыточному, потому что в часы пик меньшее количество водителей на заказ, ставший поездкой, отторговывает большую долю (на более коротких заказах). При этом в часы не пик большее количество водителей также способно отторговать больше на заказе такой же длины.
Та же логика применима и к выходным, с единственным отличием: на выходных спрос никогда не достигает такого уровня, чтобы уменьшенное количество водителей на заказ в часы пик могло отторговать большую долю, чем в часы не пик.
Мы могли бы рассмотреть возможность снижения highrate на длинных поездках, что позволило бы сохранить больший спрос и дать водителям возможность отторговать свой заработок до уровня MPH. Для этих же целей можно рассмотреть такой дизайн суржа, который не завышал бы highrate длинных так сильно.

